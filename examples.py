"""
–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Reward Bot
"""

import asyncio
from database import Database
from chat_analyzer import ChatAnalyzer
from utils import BotUtils

async def example_usage():
    """–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±–æ—Ç–∞"""
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    db = Database()
    analyzer = ChatAnalyzer()
    utils = BotUtils(db)
    
    print("üîß –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Reward Bot\n")
    
    # 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    print("1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:")
    success = await db.add_user(123456789, "example_user")
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úÖ –£—Å–ø–µ—à–Ω–æ' if success else '‚ùå –û—à–∏–±–∫–∞'}")
    
    # 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞
    print("\n2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞:")
    success = await db.add_chat(-1001234567890, "–ü—Ä–∏–º–µ—Ä —á–∞—Ç–∞", 123456789)
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úÖ –£—Å–ø–µ—à–Ω–æ' if success else '‚ùå –û—à–∏–±–∫–∞'}")
    
    # 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    print("\n3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:")
    success = await db.update_chat_activity(-1001234567890, 123456789)
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úÖ –£—Å–ø–µ—à–Ω–æ' if success else '‚ùå –û—à–∏–±–∫–∞'}")
    
    # 4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —á–∞—Ç–∞
    print("\n4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç–∞:")
    stats = await db.get_chat_stats(-1001234567890)
    print(f"   –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {stats['active_users']}")
    print(f"   –°–æ–æ–±—â–µ–Ω–∏–π: {stats['total_messages']}")
    print(f"   –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: {stats['member_count']}")
    
    # 5. –ê–Ω–∞–ª–∏–∑ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ —á–∞—Ç–∞
    print("\n5. –ê–Ω–∞–ª–∏–∑ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ —á–∞—Ç–∞:")
    chat_value = analyzer.calculate_chat_value(stats)
    print(f"   –¶–µ–Ω–Ω–æ—Å—Ç—å —á–∞—Ç–∞: {chat_value}")
    
    # 6. –ê–Ω–∞–ª–∏–∑ –∑–¥–æ—Ä–æ–≤—å—è —á–∞—Ç–∞
    print("\n6. –ê–Ω–∞–ª–∏–∑ –∑–¥–æ—Ä–æ–≤—å—è —á–∞—Ç–∞:")
    health = analyzer.analyze_chat_health(stats)
    print(f"   –û—Ü–µ–Ω–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è: {health['health_score']}/100")
    print(f"   –°—Ç–∞—Ç—É—Å: {health['health_status']}")
    print(f"   –£—Ä–æ–≤–µ–Ω—å –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏: {health['engagement_level']}")
    
    # 7. –í—ã–¥–∞—á–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è
    print("\n7. –í—ã–¥–∞—á–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è:")
    reward_amount = chat_value * 0.1  # 10% –æ—Ç —Ü–µ–Ω–Ω–æ—Å—Ç–∏
    success = await db.add_reward(123456789, -1001234567890, reward_amount)
    print(f"   –°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è: {reward_amount:.2f}")
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úÖ –£—Å–ø–µ—à–Ω–æ' if success else '‚ùå –û—à–∏–±–∫–∞'}")
    
    # 8. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    print("\n8. –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
    stats = await db.get_stats()
    print(f"   –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {stats['total_users']}")
    print(f"   –í—Å–µ–≥–æ —á–∞—Ç–æ–≤: {stats['total_chats']}")
    print(f"   –û–±—â–∞—è —Å—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π: {stats['total_rewards']:.2f}")
    print(f"   –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–Ω–æ—Å—Ç—å —á–∞—Ç–∞: {stats['avg_chat_value']:.2f}")
    
    # 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
    print("\n9. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã:")
    health = await utils.health_check()
    print(f"   –û–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: {'‚úÖ –ó–¥–æ—Ä–æ–≤–æ' if health['overall_health'] else '‚ùå –ü—Ä–æ–±–ª–µ–º—ã'}")
    print(f"   –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: {'‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞' if health['database_accessible'] else '‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞'}")
    print(f"   –¢–∞–±–ª–∏—Ü—ã: {'‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—Ç' if health['tables_exist'] else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç'}")
    
    print("\n‚úÖ –ü—Ä–∏–º–µ—Ä—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!")

def example_config():
    """–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
    print("‚öôÔ∏è  –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (.env —Ñ–∞–π–ª):")
    print("""
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
ADMIN_ID=123456789
    """)
    
    print("üìã –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:")
    print("‚Ä¢ BOT_TOKEN - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather")
    print("‚Ä¢ ADMIN_ID - –≤–∞—à Telegram ID (–ø–æ–ª—É—á–∏—Ç—å —É @userinfobot)")

def example_commands():
    """–ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥"""
    print("ü§ñ –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞:")
    print("""
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã:
/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
/help - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
/my_rewards - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
/stats - –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞
/chats - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤
/rewards - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π
/analyze_chat -1001234567890 - –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞
/user_rewards 123456789 - –í–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
/admin_help - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥–∞–º
    """)

def example_maintenance():
    """–ü—Ä–∏–º–µ—Ä—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è"""
    print("üîß –ü—Ä–∏–º–µ—Ä—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è:")
    print("""
# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
python maintenance.py backup

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)
python maintenance.py cleanup --days 7

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
python maintenance.py optimize

# –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV
python maintenance.py export

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
python maintenance.py health

# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
python maintenance.py stats

# –ü–æ–ª–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
python maintenance.py all
    """)

if __name__ == "__main__":
    print("üìö –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Reward Bot\n")
    
    print("–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–º–µ—Ä:")
    print("1. –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤")
    print("2. –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏")
    print("3. –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥")
    print("4. –ü—Ä–∏–º–µ—Ä—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è")
    print("5. –í—Å–µ –ø—Ä–∏–º–µ—Ä—ã")
    
    choice = input("\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (1-5): ").strip()
    
    if choice == "1":
        asyncio.run(example_usage())
    elif choice == "2":
        example_config()
    elif choice == "3":
        example_commands()
    elif choice == "4":
        example_maintenance()
    elif choice == "5":
        asyncio.run(example_usage())
        print("\n" + "="*50 + "\n")
        example_config()
        print("\n" + "="*50 + "\n")
        example_commands()
        print("\n" + "="*50 + "\n")
        example_maintenance()
    else:
        print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä")